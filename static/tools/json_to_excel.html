<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>JsonToExcel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <script>
        function s2ab(s) {
            const buf = new ArrayBuffer(s.length);
            const view = new Uint8Array(buf);
            for (let i = 0; i < s.length; i++) view[i] = s.charCodeAt(i) & 0xFF;
            return buf;
        }

        function exportExcel() {
            const json = document.getElementById("json").value;
            if (!json.startsWith("[")) {
                alert("不是 JSON 数组");
                return;
            }
            let data = JSON.parse(json);
            let isEleArray = false;
            if (data.length > 0 && typeof data[0] !== "object") {
                let newJsonArray = [];
                for (let i = 0; i < data.length; i++) {
                    newJsonArray.push({"key": data[i]});
                }
                data = newJsonArray;
                isEleArray = true;
            }
            const ws = isEleArray ? XLSX.utils.json_to_sheet(data, {skipHeader: true}) : XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
            const wbout = XLSX.write(wb, {bookType: 'xlsx', type: 'binary'});
            saveAs(new Blob([s2ab(wbout)], {type: "application/octet-stream"}), 'output.xlsx');
        }
    </script>
</head>
<body>
<div class="container-fluid col-xl-6 mt-4">
    <textarea id="json" rows="25" class="form-control" placeholder="请输入 JSON 对象数组"></textarea>
    <button type="button" class="btn btn-outline-dark btn-block mt-4" onclick="exportExcel()">JsonToExcel</button>
</div>
</body>
</html>
